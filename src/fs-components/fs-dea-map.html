<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../redux-mixin.html">
<link rel="import" href="../../bower_components/google-map/google-map.html">

<dom-module id="fs-dea-map">
  <template>
    <style>
      :host {
        display: block;
      }

      google-map {
        height: 93vh;
      }
    </style>

    <google-map id="googleMap" latitude="[[position.latitude]]" longitude="[[position.longitude]]" zoom="[[defaultZoomLevel]]" styles="[[mapStyle]]" api-key="AIzaSyADLJNV3Ile3ysaqqwnZQ2baCSISmG1mj0">
      <!-- DEA -->
      <template is="dom-repeat" items="[[filteredDeas]]" filter="[[filterDea]]">
        <google-map-marker id="marker-[[index]]" latitude="[[item.localisation.latitude]]" longitude="[[item.localisation.longitude]]" draggable="false" click-events="true" on-google-map-marker-click="Clicked"
          icon="../../images/aed.png">  </google-map-marker>
      </template>
      <!-- Fire station -->
      <template is="dom-repeat" items="[[filteredDeas]]" filter="[[filterFireStation]]">
        <google-map-marker latitude="[[item.localisation.latitude]]" longitude="[[item.localisation.longitude]]" draggable="false"
          icon="../../images/fire-station.png"></google-map-marker>
      </template>
      <!-- Police -->
      <template is="dom-repeat" items="[[filteredDeas]]" filter="[[filterPolice]]">
        <google-map-marker latitude="[[item.localisation.latitude]]" longitude="[[item.localisation.longitude]]" draggable="false"
          icon="../../images/police.png"></google-map-marker>
      </template>
      <!-- Pharmacy -->
      <template is="dom-repeat" items="[[filteredDeas]]" filter="[[filterPharmacy]]">
        <google-map-marker latitude="[[item.localisation.latitude]]" longitude="[[item.localisation.longitude]]" draggable="false"
          icon="../../images/pharmacy.png"></google-map-marker>
      </template>
    </google-map>
  </template>

  <script>
    (function () {
      const DEFAULT_ZOOM_LEVEL = 17;

      /**
       * Shows the DEA on a map
       * @polymer
       */
      class FsDeaMap extends ReduxMixin(Polymer.Element) {
        /**
         * Defines the name of the element
         * @return {string} Element name
         */
        static get is() { return 'fs-dea-map'; }

        /**
         * Constructor => Lifecycle
         * Initialization of some things could be done here
         */
        constructor() {
          super();
        }

        filterDea(item) {
          if (item.type === "DEA") {
            return true;
          }

          return false;
        }

        filterFireStation(item) {
          if (item.type === "fire_station") {
            return true;
          }

          return false;
        }

        filterPharmacy(item) {
          if (item.type === "pharmacy") {
            return true;
          }

          return false;
        }

        filterPolice(item) {
          if (item.type === "police") {
            return true;
          }

          return false;
        }

        /**
         * @return {object} properties- Polymer properties
         * Useage: <fs-custom-element
                      prop1="something" >
                   </fs-custom-element>
         */
        static get properties() {
          return {
            defaultZoomLevel: {
              type: Number,
              readOnly: true,
              value: DEFAULT_ZOOM_LEVEL
            },
            filteredDeas: {
              type: Array,
              value: [],
              statePath: "resource"
            },
            position: {
              type: Object,
              value: [],
              statePath: "selectedLocation"
            },
            mapStyle: {
              type: Array,
              value: [
                {
                  featureType: "administrative",
                  elementType: "labels",
                  stylers: [
                    { visibility: "off" }
                  ]
                }, {
                  featureType: "poi",
                  elementType: "labels",
                  stylers: [
                    { visibility: "off" }
                  ]
                }, {
                  featureType: "water",
                  elementType: "labels",
                  stylers: [
                    { visibility: "off" }
                  ]
                }, {
                  featureType: "road",
                  elementType: "labels",
                  stylers: [
                    { visibility: "off" }
                  ]
                }
              ]
            }
          };
        }

        Clicked(e, detail, sender){     
          let infowindow = new google.maps.InfoWindow({
            content: "Moda",
            position: {
                        lat:detail.latLng.lat(),
                        lng:detail.latLng.lng()
                       }
          });
          infowindow.open(this.$.googleMap,e.target);
        }
      }

      // Registers the element in the browser
      customElements.define(FsDeaMap.is, FsDeaMap);

    })();
  </script>

</dom-module>